#!/bin/bash

# Script to verify Railway deployment v√† config

echo "======================================"
echo "üîç RAILWAY DEPLOYMENT CHECKER"
echo "======================================"
echo ""

echo "üìù Recent commits:"
git log --oneline -3
echo ""

echo "======================================"
echo "‚ö†Ô∏è  IMPORTANT: V·∫•n ƒë·ªÅ hi·ªán t·∫°i"
echo "======================================"
echo ""
echo "L·ªói cho th·∫•y Railway ƒëang ch·∫°y CODE C≈® v·ªõi Flask-Mail SMTP"
echo "Code m·ªõi ƒë√£ ƒë∆∞·ª£c commit nh∆∞ng Railway ch∆∞a deploy ho·∫∑c thi·∫øu config"
echo ""

echo "======================================"
echo "‚úÖ GI·∫¢I PH√ÅP - L√†m theo th·ª© t·ª±:"
echo "======================================"
echo ""

echo "1Ô∏è‚É£  VERIFY RAILWAY ƒê√É DEPLOY CODE M·ªöI CH∆ØA:"
echo "   - V√†o: https://railway.app"
echo "   - Ch·ªçn project ‚Üí service"
echo "   - Tab 'Deployments' ‚Üí Xem deployment m·ªõi nh·∫•t"
echo "   - Check commit hash c√≥ ph·∫£i '12fdab3' kh√¥ng?"
echo "   - N·∫øu KH√îNG ‚Üí Click 'Deploy' ho·∫∑c 'Redeploy'"
echo ""

echo "2Ô∏è‚É£  SET BREVO_API_KEY TR√äN RAILWAY:"
echo "   - Tab 'Variables' ‚Üí Click 'New Variable'"
echo "   - Name: BREVO_API_KEY"
echo "   - Value: xkeysib-GqFjavnHgtPCBIXU"
echo "   - Click 'Add' ‚Üí Railway s·∫Ω t·ª± restart"
echo ""

echo "3Ô∏è‚É£  SET MAIL_DEFAULT_SENDER:"
echo "   - Name: MAIL_DEFAULT_SENDER"
echo "   - Value: (email ƒë√£ verify tr√™n Brevo)"
echo "   - Verify email t·∫°i: https://app.brevo.com/settings/senders"
echo ""

echo "4Ô∏è‚É£  X√ìA HO·∫∂C COMMENT C√ÅC BI·∫æN SMTP C≈® (n·∫øu c√≥):"
echo "   - MAIL_SERVER"
echo "   - MAIL_PORT"
echo "   - MAIL_USERNAME"
echo "   - MAIL_PASSWORD"
echo "   ‚Üí ƒê·ªÉ code d√πng Brevo API thay v√¨ SMTP"
echo ""

echo "5Ô∏è‚É£  FORCE REDEPLOY (n·∫øu c·∫ßn):"
echo "   railway up --detach"
echo "   # Ho·∫∑c tr√™n Dashboard: Deployments ‚Üí ... ‚Üí Redeploy"
echo ""

echo "6Ô∏è‚É£  XEM LOGS:"
echo "   railway logs"
echo "   # T√¨m:"
echo "   #   - 'üìß [BREVO API]' ‚Üí ƒêang d√πng API"
echo "   #   - '‚úÖ [BREVO API] Email sent' ‚Üí Th√†nh c√¥ng"
echo ""

echo "======================================"
echo "üêõ DEBUG: N·∫øu v·∫´n l·ªói sau khi l√†m xong"
echo "======================================"
echo ""
echo "Check logs Railway c√≥ d√≤ng n√†y kh√¥ng:"
echo ""
echo "‚úÖ ƒê√öNG (d√πng Brevo API):"
echo "   üìß [EMAIL SENDER] Using Brevo API (primary method)"
echo "   üìß [BREVO API] Starting email send to: ..."
echo ""
echo "‚ùå SAI (v·∫´n d√πng SMTP):"
echo "   üìß [SMTP FALLBACK] Attempting to send email"
echo "   ‚ùå [EMAIL ERROR] TimeoutError"
echo ""
echo "N·∫øu v·∫´n th·∫•y SMTP FALLBACK nghƒ©a l√†:"
echo "   ‚Üí BREVO_API_KEY ch∆∞a ƒë∆∞·ª£c set"
echo "   ‚Üí Ho·∫∑c Railway ch∆∞a restart sau khi set"
echo ""

echo "======================================"
echo "üìû Quick Commands"
echo "======================================"
echo ""
echo "# Check Railway env vars"
echo "railway variables"
echo ""
echo "# View logs real-time"
echo "railway logs"
echo ""
echo "# Redeploy"
echo "railway up --detach"
echo ""
